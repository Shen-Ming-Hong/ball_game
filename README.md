# 🎯 槌球遊戲機 (Ball Game Machine)

一個基於 Arduino UNO 的槌球遊戲計時系統，使用硬體中斷確保精確計時。

## 📋 專案概述

這是一個槌球遊戲機的控制系統，目前實現了精確的倒數計時功能。系統採用中斷驅動設計，確保在添加更多功能（如顯示器、感測器）時，計時精度不受影響。

### 🚀 當前功能

-   ✅ **精確倒數計時器** - 使用 Timer1 硬體中斷，確保 1 秒精確度
-   ✅ **按鈕觸發控制** - 使用外部中斷即時響應按鈕按下
-   ✅ **防抖動機制** - 200ms 防抖動，避免誤觸發
-   ✅ **狀態管理** - 閒置 → 計時中 → 結束的完整狀態循環
-   ✅ **Serial 監控** - 透過 Serial Monitor 顯示倒數進度

### 🔮 計畫功能

-   🔄 LED/LCD 顯示器支援
-   🔄 感測器整合（球數統計、分數計算）
-   🔄 音效提示功能
-   🔄 多種遊戲模式
-   🔄 分數記錄系統

## 🛠 硬體需求

### 必要元件

-   **Arduino UNO** x1
-   **按鈕開關** x1
-   **杜邦線** 若干
-   **麵包板**（可選）

### 線路連接

```
Arduino UNO    按鈕
-----------    ----
數位引腳2  ──→  按鈕一端
GND        ──→  按鈕另一端
```

> **注意**: 程式使用內建上拉電阻，無需外部電阻

## 💻 軟體環境

### 開發環境

-   **PlatformIO** (推薦)
-   **Arduino IDE** (支援)

### 平台配置

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino
```

## 📥 安裝與使用

### 1. 環境準備

```bash
# 使用PlatformIO CLI
pip install platformio

# 或使用VS Code + PlatformIO IDE插件
```

### 2. 專案設置

```bash
# 克隆專案
git clone <your-repo-url>
cd ball_game

# 編譯專案
pio run

# 上傳到Arduino
pio run --target upload
```

### 3. 監控輸出

```bash
# 開啟串列監控
pio device monitor
```

## 🎮 使用說明

1. **啟動系統**: 將程式上傳到 Arduino，開啟 Serial Monitor (波特率: 9600)
2. **開始遊戲**: 按下按鈕開始 30 秒倒數計時
3. **觀察進度**: 在 Serial Monitor 中觀察倒數進度
4. **遊戲結束**: 倒數結束後顯示結束訊息，可再次按按鈕重新開始

### 預期輸出範例

```
=== 槌球遊戲機倒數計時器 ===
按下按鈕開始倒數計時！
系統就緒，等待按鈕按下...

=== 開始倒數計時！===
倒數計時: 30 秒
倒數計時: 29 秒
倒數計時: 28 秒
...
倒數計時: 1 秒
倒數計時: 0 秒
=== 遊戲時間結束！===
按下按鈕開始新的倒數計時！
```

## 🔧 系統架構

### 核心技術特點

#### 中斷驅動設計

-   **Timer1 中斷**: 每秒精確觸發，處理倒數計時
-   **外部中斷**: 即時響應按鈕事件，不會錯過信號
-   **非阻塞架構**: 主循環保持自由，便於擴展功能

#### 狀態管理

```cpp
enum GameState {
  IDLE,        // 閒置狀態 - 等待按鈕觸發
  COUNTING,    // 計時中 - 倒數進行中
  FINISHED     // 計時結束 - 等待重新開始
};
```

#### 防抖動機制

-   **硬體防抖**: 使用上拉電阻穩定信號
-   **軟體防抖**: 200ms 防抖動視窗，避免誤觸發

### 程式碼結構

```
src/
└── main.cpp                 # 主程式
    ├── 硬體初始化          # setup()
    ├── 主迴圈              # loop()
    ├── Timer1中斷處理      # ISR(TIMER1_COMPA_vect)
    ├── 按鈕中斷處理        # buttonISR()
    └── 輔助函數            # setupTimer1(), startCountdown(), etc.
```

## ⚙️ 配置參數

### 可調整參數

```cpp
const int GAME_TIME = 30;     // 遊戲時間（秒）
const int BUTTON_PIN = 2;     // 按鈕引腳
```

### Timer1 配置

```cpp
// 16MHz / 1024分頻 = 15625 Hz
// 計數到15624 = 1秒精確中斷
OCR1A = 15624;
```

## 🚨 故障排除

### 常見問題

#### 按鈕無反應

-   檢查線路連接是否正確
-   確認按鈕未損壞
-   檢查上拉電阻是否正常工作

#### 計時不準確

-   檢查 Timer1 配置是否正確
-   確認 Arduino 晶振頻率為 16MHz
-   檢查中斷是否被其他代碼阻塞

#### Serial 無輸出

-   確認波特率設置為 9600
-   檢查 USB 連接
-   重新啟動 Serial Monitor

### 除錯技巧

```cpp
// 在setup()中添加除錯訊息
Serial.println("系統初始化完成");

// 在中斷函數中添加狀態指示
// (注意：中斷中避免使用Serial.print)
```

## 🤝 貢獻指南

歡迎提交 Issue 和 Pull Request！

### 開發規範

-   使用一致的程式碼風格
-   添加適當的註解
-   測試新功能後再提交
